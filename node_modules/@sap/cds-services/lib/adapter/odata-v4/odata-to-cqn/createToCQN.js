const { FeatureNotSupported } = require('../../../errors')

/**
 * Transform odata CREATE request into a CQN object.
 *
 * @param context - Contains request information and utility methods like statements.
 * @param req - An odata request.
 * @private
 */
const createToCQN = (context, req) => {
  const segments = req.getUriInfo().getPathSegments()
  const segment = segments[segments.length - 1]
  const SUPPORTED_KINDS = ['ENTITY.COLLECTION', 'NAVIGATION.TO.MANY']

  if (SUPPORTED_KINDS.includes(segment.getKind())) {
    return context.statements.INSERT.into(context.target).rows(context.data)
  }

  throw new FeatureNotSupported(`INSERT of kind ${segment.getKind()} is not supported`)
}

module.exports = createToCQN
