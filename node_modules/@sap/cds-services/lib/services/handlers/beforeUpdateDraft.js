const { addKeysToData, addDraftDataFromExistingDraft } = require('../utils/handlerUtils')
const { isDraftActivateAction } = require('../utils/draftUtils')

/**
 * Generic Handler for before UPDATE requests.
 *
 * @alias module:handlers.beforeUpdateDraft
 */
const beforeUpdateDraft = ({ service }) => async context => {
  if (isDraftActivateAction(context)) {
    return
  }
  addKeysToData(context.data, context.target, true)

  await addDraftDataFromExistingDraft(context, service)

  context.isDraftChange = true
  context.draft = context.draftMetadata.DraftUUID // deprecated
}

module.exports = beforeUpdateDraft
