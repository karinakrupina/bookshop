const { isNavigationToMany } = require('../utils/compositionTree')
const { isDraftActivateAction } = require('../utils/draftUtils')
const { addKeysToData, addDraftDataFromExistingDraft, addGeneratedDraftUUID } = require('../utils/handlerUtils')

/**
 * Generic Handler for before CREATE requests.
 *
 * @param service
 * @alias module:handlers.beforeCreateDraft
 */
const beforeCreateDraft = ({ service }) => async context => {
  if (isDraftActivateAction(context)) {
    return
  }
  addKeysToData(context.data, context.target)
  isNavigationToMany(context) ? await addDraftDataFromExistingDraft(context, service) : addGeneratedDraftUUID(context)
  context.isDraftChange = true
  context.draft = context.data.DraftAdministrativeData_DraftUUID // deprecated
}

module.exports = beforeCreateDraft
