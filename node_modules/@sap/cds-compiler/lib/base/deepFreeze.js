// Deep freeze an object structure
// This freezes the transitive closure of an object so that the complete structure can be considered as
// a constant. Neither properties may be changed, nor added or removed. Any try to change a property will
// result in an exception.

function deepFreeze(obj) {
  let set = new WeakSet();
  doFreeze(obj);

  function doFreeze(obj) {
    if (typeof obj !== 'object' || set.has(obj) || obj === null)
      return;
    Object.freeze(obj);
    set.add(obj);
    for (let p of Object.getOwnPropertyNames(obj))
      doFreeze(obj[p]);
    return;
  }
}

module.exports = deepFreeze;