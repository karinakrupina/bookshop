'use strict';

class ServiceResolutions {
    /**
     * The service resolution uses a base path.
     * @param {string} providedBasePath the base path
     * @param {boolean} [isBatch] whether the request is part of a batch request
     * @returns {Function} the service-resolution function
     */
    static viaBasePath(providedBasePath, isBatch = false) {
        return parsedUrl => {
            let pathname = parsedUrl.pathname;
            if (parsedUrl.pathname.startsWith(providedBasePath)) {
                pathname = pathname.substring(providedBasePath.length);
            } else if (!isBatch) {
                // In $batch following patterns are allowed:
                // http://server:port/path/service/EntitySet(1)
                // /path/service/EntitySet(1)
                // /EntitySet(1)
                throw new Error(
                    `Configured base path '${providedBasePath}' does not match provided url path '${pathname}'`);
            }
            return {
                base: providedBasePath || '',
                pathname,
                search: parsedUrl.search
            };
        };
    }
}

module.exports = ServiceResolutions;
