'use strict';

const AtomicityGroupExecutor = require('../../batch/AtomicityGroupExecutor');
const Command = require('../Command');

/**
 * Command for processing a list of BatchedRequestProcessorCommands as atomicity group
 * @extends Command
 */
class AtomicityGroupProcessorCommand extends Command {
    /**
     * Constructor
     * @param {BatchContext} batchContext Batch context
     * @param {Array.<BatchedRequestProcessorCommand>} commands List of commands
     * @param {string} atomicityGroup Atomicity group ID
     */
    constructor(batchContext, commands, atomicityGroup) {
        super();

        /**
         * Batch context
         * @type {BatchContext}
         * @private
         */
        this._batchContext = batchContext;

        /**
         * Commands to be executed
         * @type {BatchedRequestProcessorCommand[]}
         * @private
         */
        this._commands = commands;

        /**
         * Atomicity group id
         * @type {string}
         * @private
         */
        this._atomicityGroupId = atomicityGroup;
    }

    /**
     * Executes the atomicity group
     * @param {Command~Next} next the next function
     */
    execute(next) {
        new AtomicityGroupExecutor(this._batchContext, this._commands, this._atomicityGroupId).process(next);
    }
}

module.exports = AtomicityGroupProcessorCommand;
